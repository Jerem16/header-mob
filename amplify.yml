version: 1
frontend:
    phases:
        preBuild:
            commands:
                - corepack enable
                # (facultatif mais utile pour le log)
                - node -v
                - yarn -v
                # Si tu veux VRAIMENT ignorer les scripts (postinstall, etc.), utilises la var env ci-dessous
                # - export YARN_ENABLE_SCRIPTS=0
                - yarn install --immutable
        build:
            commands:
                - yarn build
    artifacts:
        baseDirectory: .next
        files:
            - "**/*"
    cache:
        paths:
            - .yarn/cache/**
            - .yarn/install-state.gz
            - .pnp.cjs
            - .pnp.loader.mjs
            # (si tu utilises nodeLinker: node-modules dans .yarnrc.yml, ajoute aussi)
            # - node_modules/**/*
