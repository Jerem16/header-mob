version: 1
frontend:
    phases:
        preBuild:
            commands:
                - nvm install 22.14.0
                - nvm use 22.14.0
                - corepack enable
                - corepack prepare yarn@4.9.2 --activate
                - yarn install --immutable
        build:
            commands:
              - export NEXT_TELEMETRY_DISABLED=1
              - rm -rf .next
              - yarn build
              - node scripts/legacy-scan.mjs || true
              - node scripts/check-legacy-budget.mjs
    artifacts:
        baseDirectory: .next
        files:
            - "**/*"
    cache:
        paths:
          - .yarn/cache/**
          - .yarn/install-state.gz
customHeaders:
    - pattern: "/img/**"
      headers:
          - key: Cache-Control
            value: "public, max-age=31536000, immutable"
    - pattern: "/css/**"
      headers:
          - key: Cache-Control
            value: "public, max-age=31536000, immutable"
